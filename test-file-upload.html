<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件上传测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
            line-height: 1.6;
        }
        .test-section {
            border: 2px dashed #ccc;
            padding: 2rem;
            margin: 1rem 0;
            border-radius: 8px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background: #0056b3;
        }
        #fileInput {
            display: none;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>文件上传功能测试</h1>
    
    <div class="test-section">
        <h2>测试1: 基础文件选择</h2>
        <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt">
        <button class="btn" id="selectFileBtn">选择文件</button>
        <p>点击按钮应该弹出文件选择对话框</p>
    </div>
    
    <div class="test-section">
        <h2>测试2: 调试信息</h2>
        <button class="btn" onclick="runDebugTest()">运行调试测试</button>
        <button class="btn" onclick="clearLog()">清除日志</button>
    </div>
    
    <div class="log" id="logOutput">
        <div>等待测试结果...</div>
    </div>
    
    <script>
        // 日志输出函数
        function log(message) {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('logOutput').innerHTML = '';
        }
        
        // 测试文件选择功能
        function setupFileUploadTest() {
            const fileInput = document.getElementById('fileInput');
            const selectBtn = document.getElementById('selectFileBtn');
            
            log('开始设置文件上传测试...');
            
            if (!fileInput) {
                log('❌ 错误: 未找到fileInput元素');
                return;
            }
            
            if (!selectBtn) {
                log('❌ 错误: 未找到选择文件按钮');
                return;
            }
            
            // 绑定文件选择变化事件
            fileInput.addEventListener('change', function(e) {
                log(`✅ 文件选择成功: ${e.target.files.length} 个文件`);
                Array.from(e.target.files).forEach((file, index) => {
                    log(`   文件${index + 1}: ${file.name} (${file.type || '未知类型'})`);
                });
            });
            
            // 绑定按钮点击事件
            selectBtn.addEventListener('click', function(e) {
                e.preventDefault();
                log('🖱️ 选择文件按钮被点击');
                
                try {
                    fileInput.click();
                    log('✅ 成功触发文件选择对话框');
                } catch (error) {
                    log(`❌ 触发文件选择失败: ${error.message}`);
                }
            });
            
            log('✅ 文件上传测试设置完成');
        }
        
        function runDebugTest() {
            log('=== 开始调试测试 ===');
            
            const fileInput = document.getElementById('fileInput');
            const selectBtn = document.getElementById('selectFileBtn');
            
            log(`fileInput元素: ${fileInput ? '✅ 存在' : '❌ 不存在'}`);
            log(`选择文件按钮: ${selectBtn ? '✅ 存在' : '❌ 不存在'}`);
            
            if (fileInput) {
                log(`fileInput.id: ${fileInput.id}`);
                log(`fileInput.accept: ${fileInput.accept}`);
                log(`fileInput.hidden: ${fileInput.hidden}`);
                log(`fileInput.disabled: ${fileInput.disabled}`);
            }
            
            if (selectBtn) {
                log(`按钮.id: ${selectBtn.id}`);
                log(`按钮.className: ${selectBtn.className}`);
                log(`按钮.textContent: ${selectBtn.textContent}`);
            }
            
            // 测试浏览器兼容性
            log(`浏览器信息: ${navigator.userAgent}`);
            log(`是否支持File API: ${window.File ? '✅' : '❌'}`);
            log(`是否支持FileList: ${window.FileList ? '✅' : '❌'}`);
            log(`是否支持FileReader: ${window.FileReader ? '✅' : '❌'}`);
            
            log('=== 调试测试完成 ===');
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('📄 页面加载完成，开始初始化测试');
            setupFileUploadTest();
        });
    </script>
</body>
</html>
